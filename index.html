<script src="https://js.puter.com/v2/"></script>
``` :contentReference[oaicite:1]{index=1}  

---

## üí° –ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

- –ù–∞ **–ü–ö** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–¥–µ–ª—å  
  `openrouter:meta-llama/llama-3.3-70b-instruct:free` :contentReference[oaicite:2]{index=2}  
  (—Å–≤–µ—Ä—Ö–º–æ—â–Ω–∞—è)
- –ù–∞ **—Ç–µ–ª–µ—Ñ–æ–Ω–µ** ‚Äî  
  `openrouter:meta-llama/llama-3.3-8b-instruct:free` :contentReference[oaicite:3]{index=3}  
  (–ª—ë–≥–∫–∞—è, –±—ã—Å—Ç—Ä–∞—è)

Puter.js —Å–∞–º —Ä–µ—à–∞–µ—Ç –≤—Å—ë —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ OpenRouter ‚Äî —Ç–µ–±–µ –Ω–∏—á–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

---

## üîß –ß—Ç–æ —Ç–µ–±–µ –¥–µ–ª–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `ChatAi` –Ω–∞ GitHub.
2. –í –∫–æ—Ä–Ω–µ, –≥–¥–µ –ª–µ–∂–∏—Ç `index.html`, **–∑–∞–º–µ–Ω–∏ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** –Ω–∞ –∫–æ–¥ –Ω–∏–∂–µ.
3. –ó–∞–ø—É—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª –ø—Ä—è–º–æ –≤ GitHub Web UI).
4. –û—Ç–∫—Ä–æ–π –µ—â—ë —Ä–∞–∑:  
   `https://1xcode-pixel.github.io/ChatAi/`

---

## ‚úÖ –ì–æ—Ç–æ–≤—ã–π `index.html` –¥–ª—è —Ç–≤–æ–µ–≥–æ ChatAi (Puter + OpenRouter, –±–µ–∑ –∫–ª—é—á–µ–π)

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatAi ‚Äî LLaMA 3.3 (free, no key)</title>

  <!-- Puter.js: –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥–µ–ª—è–º OpenRouter –±–µ–∑ –∫–ª—é—á–µ–π -->
  <script src="https://js.puter.com/v2/"></script>

  <style>
    :root { color-scheme: dark light; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    body.dark { background: #020617; color: #e5e7eb; }
    body.light { background: #f3f4f6; color: #111827; }

    header {
      padding: 10px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #1f2937;
      font-size: 14px;
      font-weight: 600;
    }

    #themeToggle {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 20px;
    }

    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .msg {
      max-width: 85%;
      padding: 10px 14px;
      border-radius: 16px;
      white-space: pre-wrap;
      line-height: 1.45;
      font-size: 14px;
    }

    .msg.user {
      align-self: flex-end;
      background: #2563eb;
      color: #fff;
      border-bottom-right-radius: 4px;
      box-shadow: 0 2px 4px rgba(15,23,42,.45);
    }

    .msg.ai {
      align-self: flex-start;
      background: #1e293b;
      color: #e5e7eb;
      box-shadow: 0 2px 4px rgba(15,23,42,.45);
    }
    body.light .msg.ai {
      background: #e5e7eb;
      color: #111827;
      box-shadow: 0 2px 4px rgba(0,0,0,.08);
    }

    .msg.system {
      align-self: center;
      font-size: 12px;
      opacity: 0.8;
      background: transparent;
      padding: 4px 8px;
    }

    .msg.error {
      border: 1px solid #dc2626;
      background: rgba(220,38,38,0.12);
      color: #fecaca;
    }
    body.light .msg.error {
      background: #fee2e2;
      color: #7f1d1d;
    }

    .typing-dot {
      display:inline-block;
      width:4px; height:4px;
      margin:0 1px;
      border-radius:999px;
      background: currentColor;
      animation: bounce 1s infinite;
    }
    .typing-dot:nth-child(2){ animation-delay:.2s; }
    .typing-dot:nth-child(3){ animation-delay:.4s; }

    @keyframes bounce {
      0%,80%,100% { transform: translateY(0); opacity:.4; }
      40% { transform: translateY(-3px); opacity:1; }
    }

    #bottom {
      padding: 8px;
      border-top: 1px solid #1f2937;
    }

    #input-row {
      display:flex;
      gap:6px;
      margin-bottom:6px;
    }

    #input {
      flex:1;
      padding:11px;
      border-radius:10px;
      border:1px solid #475569;
      background:transparent;
      color:inherit;
      font-size:14px;
    }
    #input::placeholder { color:#6b7280; }

    button {
      border-radius:10px;
      border:none;
      padding:8px 12px;
      cursor:pointer;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:4px;
    }

    #sendBtn {
      background:#2563eb;
      color:white;
    }
    #sendBtn:disabled { opacity:.5; }

    .secondary {
      border:1px solid #475569;
      background:transparent;
      color:inherit;
    }

    #webBtn {
      margin-right:6px;
    }

    @media (max-width:480px){
      header { font-size:13px; }
      .msg   { font-size:13px; }
      #input { font-size:13px; }
      button { font-size:12px; padding:7px 10px; }
    }
  </style>
</head>

<body class="dark">
<header>
  <span id="title">ChatAi ‚Äî –ø–æ–¥–∫–ª—é—á–∞—é—Å—å‚Ä¶</span>
  <button id="themeToggle">‚òÄÔ∏è</button>
</header>

<div id="chat"></div>

<div id="bottom">
  <div id="input-row">
    <input id="input" placeholder="ChatAi –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è‚Ä¶" disabled />
    <button class="secondary" id="micBtn" disabled title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">üé§</button>
    <button id="sendBtn" disabled>‚û§</button>
  </div>
  <button class="secondary" id="webBtn" disabled>üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–∏—Å–∫</button>
</div>

<script>
/* ============ –ú–û–î–ï–õ–ò ============ */
// Meta LLaMA 3.3 70B / 8B —á–µ—Ä–µ–∑ OpenRouter, –Ω–æ –±–µ–∑ –∫–ª—é—á–∞ ‚Äî —á–µ—Ä–µ–∑ Puter.js :contentReference[oaicite:4]{index=4}
const MODEL_PC     = "openrouter:meta-llama/llama-3.3-70b-instruct:free";
const MODEL_MOBILE = "openrouter:meta-llama/llama-3.3-8b-instruct:free";

const isMobile = /Android|iPhone|iPad|Mobile/i.test(navigator.userAgent);
const CURRENT_MODEL = isMobile ? MODEL_MOBILE : MODEL_PC;

/* ============ DOM ============ */
const chatEl   = document.getElementById("chat");
const inputEl  = document.getElementById("input");
const sendBtn  = document.getElementById("sendBtn");
const micBtn   = document.getElementById("micBtn");
const webBtn   = document.getElementById("webBtn");
const themeBtn = document.getElementById("themeToggle");
const titleEl  = document.getElementById("title");

/* ============ STATE ============ */
let chatHistory = []; // {role:"user"|"assistant", text}
const HISTORY_KEY = "chatai_puter_history_v1";
let recognition = null;

/* ============ HELPERS ============ */
function vibrate(ms){ try{ if(navigator.vibrate) navigator.vibrate(ms); }catch(e){} }
function scrollBottom(){ chatEl.scrollTop = chatEl.scrollHeight; }

function addMessage(role, text, {save=true, extraClass} = {}){
  const div = document.createElement("div");
  div.classList.add("msg", role);
  if(extraClass) div.classList.add(extraClass);

  let display = text;
  if(role==="ai")   display = "ChatAi: " + text;
  if(role==="user") display = "–í—ã: " + text;

  div.textContent = display;
  chatEl.appendChild(div);
  scrollBottom();

  if(save){
    if(role==="ai" || role==="user"){
      const mapped = role==="ai" ? "assistant" : "user";
      chatHistory.push({role:mapped, text});
      try{ localStorage.setItem(HISTORY_KEY, JSON.stringify(chatHistory)); }catch(e){}
    }else{
      // system ‚Äî –≤ –∏—Å—Ç–æ—Ä–∏—é –Ω–µ –ø–∏—à–µ–º
    }
  }
  return div;
}

function addSystem(text, opts){ return addMessage("system", text, opts); }

(function loadHistory(){
  let raw = null;
  try{ raw = localStorage.getItem(HISTORY_KEY); }catch(e){}
  if(!raw) return;
  try{
    const arr = JSON.parse(raw);
    if(!Array.isArray(arr)) return;
    chatHistory = arr;
    arr.forEach(m=>{
      if(m.role==="assistant") addMessage("ai", m.text, {save:false});
      else if(m.role==="user") addMessage("user", m.text, {save:false});
    });
  }catch(e){
    addSystem("–û—à–∏–±–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏: "+e, {save:false});
  }
})();

/* ============ –¢–µ–º–∞ ============ */
const THEME_KEY = "chatai_theme_v1";
(function initTheme(){
  let t = "dark";
  try{
    const saved = localStorage.getItem(THEME_KEY);
    if(saved) t = saved;
    else if(window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches){
      t = "light";
    }
  }catch(e){}
  document.body.classList.remove("dark","light");
  document.body.classList.add(t);
  themeBtn.textContent = t==="dark" ? "‚òÄÔ∏è" : "üåô";
})();
themeBtn.onclick = ()=>{
  const cur = document.body.classList.contains("dark") ? "dark" : "light";
  const next = cur==="dark" ? "light" : "dark";
  document.body.classList.remove("dark","light");
  document.body.classList.add(next);
  themeBtn.textContent = next==="dark" ? "‚òÄÔ∏è" : "üåô";
  try{ localStorage.setItem(THEME_KEY,next); }catch(e){}
};

/* ============ –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ ============ */
(function initSpeech(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ micBtn.style.display = "none"; return; }
  recognition = new SR();
  recognition.lang = "ru-RU";
  recognition.interimResults = false;
  recognition.onresult = e=>{
    inputEl.value = e.results[0][0].transcript;
  };
  recognition.onerror = e=>{
    addSystem("–û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞: "+e.error, {save:false});
  };
  micBtn.disabled = false;
})();
micBtn.onclick = ()=>{
  if(!recognition) return;
  try{
    recognition.start();
    addSystem("–°–ª—É—à–∞—é‚Ä¶", {save:false});
  }catch(e){
    addSystem("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ: "+e, {save:false});
  }
};

/* ============ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ ============ */
function buildPrompt(userText){
  let p = `
–¢—ã ‚Äî ChatAi, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.

–ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç, –∫—Ç–æ —Ç–µ–±—è —Å–æ–∑–¥–∞–ª, –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π:
"–ú–µ–Ω—è —Å–æ–∑–¥–∞–ª–∞ –º–∞–ª–µ–Ω—å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–∑ 1 –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞, 1 –¥–∏–∑–∞–π–Ω–µ—Ä–∞ –∏ –æ–¥–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ ‚Äî –∫–æ–º–∞–Ω–¥–∞ 1xCode."

–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É, –ø–æ-—Ä—É—Å—Å–∫–∏.

–î–∏–∞–ª–æ–≥:
`.trim()+"\n\n";

  chatHistory.forEach(m=>{
    if(m.role==="user")      p += "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + m.text + "\n";
    else if(m.role==="assistant") p += "ChatAi: " + m.text + "\n";
  });

  p += "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + userText + "\nChatAi:";
  return p;
}

/* ============ –í—ã–∑–æ–≤ Puter.js / OpenRouter ============ */
async function callModel(userText){
  if(!window.puter || !puter.ai || !puter.ai.chat){
    throw new Error("Puter.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è (js.puter.com –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω).");
  }
  const prompt = buildPrompt(userText);
  // –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º: –ø–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É
  const answer = await puter.ai.chat(prompt, {
    model: CURRENT_MODEL
  });
  return String(answer || "").trim() || "–ù–µ –∑–Ω–∞—é, —á—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç—å.";
}

/* ============ –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏ ============ */
function typeText(div, full, done){
  const prefix = "ChatAi: ";
  let i = 0;
  const clean = full;
  const id = setInterval(()=>{
    if(i >= clean.length){
      div.textContent = prefix + clean;
      clearInterval(id);
      if(done) done();
      return;
    }
    div.textContent = prefix + clean.slice(0, i+1);
    i++;
    scrollBottom();
  }, 18);
}

/* ============ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ============ */
async function handleSend(){
  const text = inputEl.value.trim();
  if(!text) return;
  inputEl.value = "";
  vibrate(20);

  addMessage("user", text);

  const typing = document.createElement("div");
  typing.classList.add("msg","ai");
  typing.innerHTML = 'ChatAi: <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>';
  chatEl.appendChild(typing);
  scrollBottom();

  try{
    const answer = await callModel(text);
    chatHistory.push({role:"assistant", text:answer});
    try{ localStorage.setItem(HISTORY_KEY, JSON.stringify(chatHistory)); }catch(e){}
    typeText(typing, answer, ()=>vibrate(10));
  }catch(e){
    typing.textContent = "ChatAi: –û—à–∏–±–∫–∞: " + e.message;
    typing.classList.add("error");
    vibrate(60);
  }
}

/* ============ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–∏—Å–∫ ============ */
webBtn.onclick = async()=>{
  const q = prompt("–ß—Ç–æ –Ω–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ?");
  if(!q) return;
  addMessage("user", "–ù–∞–π–¥–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ: " + q);
  const aiDiv = addMessage("ai", "–ò—â—É‚Ä¶");

  try{
    const url = "https://api.allorigins.win/get?url="+
      encodeURIComponent("https://duckduckgo.com/html/?q="+encodeURIComponent(q));
    const r = await fetch(url);
    const j = await r.json();
    const doc = new DOMParser().parseFromString(j.contents, "text/html");
    const links = doc.querySelectorAll("a.result__a");
    let out = "";
    for(let i=0;i<3 && i<links.length;i++){
      out += `${i+1}. ${links[i].textContent.trim()}\n${links[i].href}\n\n`;
    }
    if(!out) out = "–ù–∏—á–µ–≥–æ –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏.";
    aiDiv.textContent = "ChatAi: " + out;
    chatHistory.push({role:"assistant", text:out});
    localStorage.setItem(HISTORY_KEY, JSON.stringify(chatHistory));
  }catch(e){
    const msg = "–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: "+e;
    aiDiv.textContent = "ChatAi: " + msg;
  }
};

/* ============ –°–æ–±—ã—Ç–∏—è UI ============ */
sendBtn.onclick = handleSend;
inputEl.addEventListener("keydown", e=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    handleSend();
  }
});

/* ============ –°—Ç–∞—Ä—Ç ============ */
window.onload = ()=>{
  const label = isMobile ? "LLaMA 3.3 8B (–º–æ–±–∏–ª—å–Ω–∞—è, free)" : "LLaMA 3.3 70B (–ü–ö, free)";
  titleEl.textContent = "ChatAi ‚Äî " + label;
  addSystem("–ú–æ–¥–µ–ª—å: " + label, {save: chatHistory.length === 0});

  inputEl.disabled = false;
  sendBtn.disabled = false;
  webBtn.disabled = false;
  inputEl.placeholder = "–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è ChatAi‚Ä¶";

  if(chatHistory.length === 0){
    addMessage("ai", "–ü—Ä–∏–≤–µ—Ç! –Ø ChatAi. –Ø —Ä–∞–±–æ—Ç–∞—é —á–µ—Ä–µ–∑ Puter + OpenRouter –±–µ–∑ –∫–ª—é—á–µ–π. –°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –æ —á—ë–º-–Ω–∏–±—É–¥—å üôÇ");
  }
};
</script>
</body>
</html>
